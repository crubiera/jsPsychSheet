<!DOCTYPE html>
<html>
    <head>
	<!-- jsPsych library -->
	<base target="_top">
	<!-- jsPsych library -->
	<script src="https://crubiera.github.io/jsPsychSheet/jspsych/jspsych.js"></script>
	<script src="https://crubiera.github.io/jsPsychSheet/jspsych/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="https://crubiera.github.io/jsPsychSheet/jspsych/plugins/jspsych-external-html.js"></script>
	<script src="https://crubiera.github.io/jsPsychSheet/jspsych/plugins/jspsych-html-slider-response.js"></script>
	<script src="https://crubiera.github.io/jsPsychSheet/jspsych/plugins/jspsych-video-button-response.js"></script>
  <script src="https://crubiera.github.io/jsPsychSheet/jspsych/plugins/jspsych-video-keyboard-response.js"></script>
  <script src="https://crubiera.github.io/jsPsychSheet/jspsych/plugins/jspsych-image-keyboard-response.js"></script>
	<link rel="stylesheet" href="https://crubiera.github.io/jsPsychSheet/jspsych/css/jspsych.css">

	<!-- jsPsychSheet library -->
    	<base target="_top">
    	<script src="https://crubiera.github.io/jsPsychSheet/jspsychsheet.js"></script>
    	<link rel="stylesheet" href="https://crubiera.github.io/jsPsychSheet/jspsychsheet.css">
    </head>
    <body></body>
    <script>

	// generate a random subject ID with 15 characters
	var subject_id = jsPsych.randomization.randomID(6);

	// record the condition assignment in the jsPsych data
	// this adds a property called 'subject' and a property called 'condition' to every trial
	jsPsych.data.addProperties({
  		subject: subject_id,
	});

	/* create timeline */
	var timeline = [];

	/* define welcome message trial */
	var welcome = {
  		type: "html-keyboard-response",
  		stimulus: "Welcome to the experiment. We will need to obtain your consent for this experiment. Press any key to move on to the consent page."
	}

    var check_consent = function(elem) {
      if (document.getElementById('consent_checkbox').checked) {
        return true;
      }
      else {
        alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
        return false;
      }
      return false;
    };

    var consent = {
      type:'external-html',
      url: "https://ufpaclab.github.io/Consent-Forms/Active/Consent.html",
      cont_btn: "consent-button",
    };

  	var instructions = {
     	type: "html-keyboard-response",
     	stimulus: "For the duration of this experiment, please plug in headphones or turn on your speakers to a comfortable volume. In this task, we will be testing the McGurk effect. The McGurk effect is a perceptual phenomenon that demonstrates an interaction between hearing and vision in speech perception. The illusion occurs when the auditory component of one sound is paired with the visual component of another sound, leading to the perception of a third sound. Press any key to continue."
        }

    timeline.push(welcome,consent,instructions);

    var pre_if_trial = {
      type: 'video-keyboard-response',
      sources: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualBa.mp4'],
      width: 800,
  		prompt: '<p> Press Y if you heard the video, or R to replay it.<p>'
  	}
  
  	var if_trial = {
      type: 'html-keyboard-response',
      stimulus: 'You are ready to begin the experiment. Press any key to continue.'
  	}
  
  	var if_node = {
      timeline: [if_trial],
      		conditional_function: function(){
          		// get the data from the previous trial,
          		// and check which key was pressed
          		var data = jsPsych.data.get().last(1).values()[0];
          		if(data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode('y')){
              			return false;
          		} else {
              			return true;
          		}
      		}
  	}
  
  	var after_if_trial = {
        type: 'html-keyboard-response',
      	stimulus: 'Press any key to continue.'
  	};
      timeline.push(pre_if_trial, if_trial, if_node, after_if_trial);

    var instructions_pt2 = {
       type: "image-keyboard-response",
       stimulus: "https://crubiera.github.io/jsPsychSheet/experiment/video/armsLength.png",
       prompt: "<p>Your screen should be arms length away from your body as demonstrated in the picture.</p>"
        }

	timeline.push(instructions_pt2);


    /* Present a randomized order of all of the videos/trials you wish to show */
    /* Make sure the answer choices are contingent on the video */
    /* The answer choices are mainly from Table 1 in Stropahl et al., 2017 */
    /* We'll have to decide which options to give for the ones that aren't from that table */
    /* To learn more, check out https://www.jspsych.org/overview/timeline/#timeline-variables */
    
    var practice_trial_instructions = {
      type: "html-keyboard-response",
      stimulus: "We will begin a practice trial of the experiment. Press any key to begin the practice trial."
    };
    timeline.push(practice_trial_instructions);

    var practice_trial = {
      timeline: [
			{
				type: 'video-button-response',
				sources: jsPsych.timelineVariable('video'),
				width: 800,
				choices: [],
				data: jsPsych.timelineVariable('video'), /* Store the video name */
				trial_ends_after_video: true,
				prompt: '<p></p>'
				
			},
			{
				type: 'video-button-response',
				sources: [],
				width: 800,
				choices: jsPsych.timelineVariable('syllables'),
				data: jsPsych.timelineVariable('syllables'), /* Store the answer choices on that trial */
				prompt: '<p>Which syllable did you perceive?</p>'
				
			},
			{
				type: 'html-slider-response',
				stimulus: '<p>How confident are you in your answer?</p>',
				labels: ['0','25','50','75','100'],
				min: 0,
				max: 100,
				start: function(){
					return jsPsych.randomization.sampleWithoutReplacement([10, 20, 30, 40, 50, 60, 70, 80, 90], 1)[0];
					},
				step: 1,
				prompt: "<p>Rate confidence from 0 (no confidence) to 100 (fully confident)</p>"
			}
		],
		timeline_variables: [
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualBa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Pa','Ga','Ma'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Ga','Da','Ma'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryDaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Da'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ga','Ka','Ta'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Pa','Ga','Ba'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryNaVisualDa.mp4'], syllables: jsPsych.randomization.repeat(['Na','Da','Ka','Ma'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualPa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Ba'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualTa.mp4'], syllables: jsPsych.randomization.repeat(['Pa','Ta','Da','Ka'],1) },
			{ video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryTaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ta','Ga','Ka','Da'],1) },
			
		],
		randomize_order: true,
    	repetitions: 1
	}
	timeline.push(practice_trial);

    var practice_trial_end = {
      type: "html-keyboard-response",
      stimulus: "Congratulations! You have finished the practice trial run. We will now proceed to the real experiment. Press any key to begin."
    };
    timeline.push(practice_trial_end);
    
	var mcGurkProcedure1 = {
		timeline: [
			{
				type: 'video-button-response',
				sources: jsPsych.timelineVariable('video'),
				width: 800,
				choices: [],
				data: jsPsych.timelineVariable('video'), /* Store the video name */
				trial_ends_after_video: true,
				prompt: '<p></p>'

      },
      {
  			type: 'html-slider-response',
  			stimulus: '<p>How confident are you that the auditory and visual syllables were the same?</p>',
  			labels: ['0','25','50','75','100'],
  			min: 0,
  			max: 100,
  			start: function(){
  				return jsPsych.randomization.sampleWithoutReplacement([10, 20, 30, 40, 50, 60, 70, 80, 90], 1)[0];
  				},
  			step: 1,
  			prompt: "<p>Rate confidence from 0 (no confidence) to 100 (fully confident)</p>"

      },
			{
				type: 'video-button-response',
				sources: [],
				width: 800,
				choices: jsPsych.timelineVariable('syllables'),
				data: jsPsych.timelineVariable('syllables'), /* Store the answer choices on that trial */
				prompt: '<p>Which syllable did you perceive?</p>'
			}  
		],
		timeline_variables: [
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualBa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Pa','Ga','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Ga','Da','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryDaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Da'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ga','Ka','Ta'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Pa','Ga','Ba'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryNaVisualDa.mp4'], syllables: jsPsych.randomization.repeat(['Na','Da','Ka','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualPa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Ba'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualTa.mp4'], syllables: jsPsych.randomization.repeat(['Pa','Ta','Da','Ka'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryTaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ta','Ga','Ka','Da'],1) },

		],
		randomize_order: true,
    	repetitions: 5
	}
	timeline.push(mcGurkProcedure1);

  var rest1 = {
      type: "html-keyboard-response",
      stimulus: "You will now have a short break. There is no time limit. Press any key to resume the experiment."
  };
  timeline.push(rest1); 

  var mcGurkProcedure2 = {
    timeline: [
			{
				type: 'video-button-response',
				sources: jsPsych.timelineVariable('video'),
				width: 800,
				choices: [],
				data: jsPsych.timelineVariable('video'), /* Store the video name */
				trial_ends_after_video: true,
				prompt: '<p></p>'

      },
      {
  			type: 'html-slider-response',
  			stimulus: '<p>How confident are you that the auditory and visual syllables were the same?</p>',
  			labels: ['0','25','50','75','100'],
  			min: 0,
  			max: 100,
  			start: function(){
  				return jsPsych.randomization.sampleWithoutReplacement([10, 20, 30, 40, 50, 60, 70, 80, 90], 1)[0];
  				},
  			step: 1,
  			prompt: "<p>Rate confidence from 0 (no confidence) to 100 (fully confident)</p>"

      },
			{
				type: 'video-button-response',
				sources: [],
				width: 800,
				choices: jsPsych.timelineVariable('syllables'),
				data: jsPsych.timelineVariable('syllables'), /* Store the answer choices on that trial */
				prompt: '<p>Which syllable did you perceive?</p>'
			}  
		],
		timeline_variables: [
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualBa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Pa','Ga','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Ga','Da','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryDaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Da'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ga','Ka','Ta'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Pa','Ga','Ba'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryNaVisualDa.mp4'], syllables: jsPsych.randomization.repeat(['Na','Da','Ka','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualPa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Ba'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualTa.mp4'], syllables: jsPsych.randomization.repeat(['Pa','Ta','Da','Ka'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryTaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ta','Ga','Ka','Da'],1) },

		],
		randomize_order: true,
    	repetitions: 5
	}
	timeline.push(mcGurkProcedure2);

  var rest2 = {
      type: "html-keyboard-response",
      stimulus: "You will now have a short break. There is no time limit. Press any key to resume the experiment."
  };
  timeline.push(rest2); 

  var mcGurkProcedure3 = {
    timeline: [
			{
				type: 'video-button-response',
				sources: jsPsych.timelineVariable('video'),
				width: 800,
				choices: [],
				data: jsPsych.timelineVariable('video'), /* Store the video name */
				trial_ends_after_video: true,
				prompt: '<p></p>'

      },
      {
  			type: 'html-slider-response',
  			stimulus: '<p>How confident are you that the auditory and visual syllables were the same?</p>',
  			labels: ['0','25','50','75','100'],
  			min: 0,
  			max: 100,
  			start: function(){
  				return jsPsych.randomization.sampleWithoutReplacement([10, 20, 30, 40, 50, 60, 70, 80, 90], 1)[0];
  				},
  			step: 1,
  			prompt: "<p>Rate confidence from 0 (no confidence) to 100 (fully confident)</p>"

      },
			{
				type: 'video-button-response',
				sources: [],
				width: 800,
				choices: jsPsych.timelineVariable('syllables'),
				data: jsPsych.timelineVariable('syllables'), /* Store the answer choices on that trial */
				prompt: '<p>Which syllable did you perceive?</p>'
			}  
		],
		timeline_variables: [
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualBa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Pa','Ga','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryBaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ba','Ga','Da','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryDaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Da'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ga','Ka','Ta'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryMaVisualMa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Pa','Ga','Ba'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryNaVisualDa.mp4'], syllables: jsPsych.randomization.repeat(['Na','Da','Ka','Ma'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualPa.mp4'], syllables: jsPsych.randomization.repeat(['Ma','Ta','Ga','Ba'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryPaVisualTa.mp4'], syllables: jsPsych.randomization.repeat(['Pa','Ta','Da','Ka'],1) },
      { video: ['https://crubiera.github.io/jsPsychSheet/experiment/video/AuditoryTaVisualGa.mp4'], syllables: jsPsych.randomization.repeat(['Ta','Ga','Ka','Da'],1) },

		],
		randomize_order: true,
    	repetitions: 5
	}
	timeline.push(mcGurkProcedure3);

  var experiment_end = {
      type: "html-keyboard-response",
      stimulus: "Congratulations! You have reached the end of the experiment. Please do not close your window until it says that the data has finished uploading on the next screen. Press any key to upload your results."
  };
  timeline.push(experiment_end);
  
	/* start the experiment */
	jsPsych.init({
  		timeline: timeline,
  		show_progress_bar: true,
  		on_finish: function() {
      			jsPsychSheet.uploadData(jsPsych.data.get().csv());
  		}
	});

    </script>
</html>
